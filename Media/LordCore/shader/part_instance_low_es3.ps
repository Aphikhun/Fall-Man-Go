#version 300 es

uniform mediump sampler2DArray uMaterialLayerTexture;    // 图集

in highp   vec2  ourTexcoord;
in mediump vec4  ourColor;
in mediump vec3  ourLightFactor;
in mediump float ourMaterialIndex; 
in mediump vec4  ourFogColor;

mediump vec3 CalcAlbedo() {
    return texture(uMaterialLayerTexture, vec3(ourTexcoord, int(ourMaterialIndex))).rgb;
}

out mediump vec4 outFragColor;
void main() {
    mediump vec3 albedo = CalcAlbedo() * vec3(ourColor);
    mediump vec3 result = albedo * ourLightFactor;
	outFragColor = vec4(mix(ourFogColor.rgb, result, ourFogColor.a), ourColor.a);
}