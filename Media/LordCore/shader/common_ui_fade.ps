#version 100

uniform sampler2D texSampler;

varying mediump vec4 color;
varying mediump vec2 texCoord;
varying mediump vec4 brightness;

void main(void)
{
	mediump vec4 textureColor = texture2D(texSampler, texCoord);
	mediump float pA = textureColor.w == 0.0 ? 0.0 : 1.0;
	mediump vec4 texColor = textureColor * vec4(pA, pA, pA, pA);
	texColor.x = texColor.x == 1.0 ? 255.0 : (texColor.x / (1.0 - texColor.x));
	texColor.y = texColor.y == 1.0 ? 255.0 : (texColor.y / (1.0 - texColor.y));
	texColor.z = texColor.z == 1.0 ? 255.0 : (texColor.z / (1.0 - texColor.z));
	gl_FragColor = texColor * color + brightness;
}